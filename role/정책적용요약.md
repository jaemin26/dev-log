### API별 접근 권한 매트릭스

| API 엔드포인트 | BUYER | ADMIN | VENDOR | USER |
| --- | --- | --- | --- | --- |
| `GET /api/v1/purchase-orders` | ✅ | ✅ | ❌ | ❌ |
| `GET /api/v1/purchase-orders/vendor/orders` | ❌ | ❌ | ✅ | ❌ |
| `GET /api/v1/purchase-orders/pending` | ✅ | ✅ | ❌ | ❌ |
| `GET /api/v1/purchase-orders/{no}` | ✅ | ✅ | ✅* | ❌ |
| `POST /api/v1/purchase-orders` | ✅ | ✅ | ❌ | ❌ |
| `PUT /api/v1/purchase-orders/{no}` | ✅ | ✅ | ❌ | ❌ |
| `DELETE /api/v1/purchase-orders/{no}` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/purchase-orders/{no}/confirm` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/purchase-orders/{no}/approve` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/purchase-orders/{no}/reject` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/purchase-orders/{no}/send` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/purchase-orders/{no}/close` | ✅ | ✅ | ❌ | ❌ |
| `PUT /api/v1/purchase-orders/{no}/vendor-confirm` | ❌ | ❌ | ✅* | ❌ |
| `GET /api/v1/goods-receipts/**` | ✅ | ✅ | ❌ | ❌ |
| `POST /api/v1/goods-receipts/**` | ✅ | ✅ | ❌ | ❌ |

> *VENDOR는 본인 협력사 발주만 접근 가능
> 

---

## **구매사 기준 권한 구현**

**LoginMapper.xml (48-59번 라인)**

```sql
CASE
    WHEN u.USER_ID = 'master' THEN 'ADMIN'
    WHEN EXISTS (
            SELECT 1
            FROM dept_role m
            WHERE m.COM_TYPE = 'B'
              AND m.DEPT_CD = u.DEPT_CD
              AND m.ROLE = 'BUYER'
              AND m.USE_FLAG = 'Y'
        ) THEN 'BUYER'
    ELSE 'USER'
    END AS role
```

**동작 방식**

1. ADMIN: master 사용자는 항상 ADMIN
2. BUYER: dept_role 테이블에서 사용자의 부서(DEPT_CD)가 BUYER 권한을 가지고 있으면 BUYER
3. USER: 그 외 사용자는 USER

**현재 데이터 상태**

- *- dept_role 테이블 데이터*

('B','PUR01','BUYER','Y',...)  *-- 구매1팀 → BUYER 권한*

('B','PUR02','BUYER','Y',...)  *-- 구매2팀 → BUYER 권한*

**실제 사용자 권한 예시**

| 사용자ID | 부서코드 | 부서명 | 권한 | 이유 |
| --- | --- | --- | --- | --- |
| master | - | - | **ADMIN** | master 사용자 |
| buyer01 | PUR01 | 구매1팀 | **BUYER** | PUR01이 dept_role에 BUYER로 등록됨 |
| buyer02 | PUR02 | 구매2팀 | **BUYER** | PUR02가 dept_role에 BUYER로 등록됨 |
| user01 | SAL01 | 영업1팀 | **USER** | SAL01은 dept_role에 없음 |
| user02 | ACC01 | 회계1팀 | **USER** | ACC01은 dept_role에 없음 |
| user03 | DEV01 | 개발1팀 | **USER** | DEV01은 dept_role에 없음 |

**결론**

구매사 기준 권한은 이미 구현되어 있습니다.

- 로그인 시 dept_role 테이블을 조회하여 부서별 권한을 결정
- SessionUser에 role 필드로 저장
- SessionInterceptor에서 @RequireRole과 비교하여 접근 제어

따라서

- 구매1팀(PUR01), 구매2팀(PUR02) → BUYER 권한 → 발주/입고 접근 가능
- 영업팀(SAL01), 회계팀(ACC01), 개발팀(DEV01) → USER 권한 → 발주/입고 접근 불가

부서별 권한 관리는 dept_role 테이블에서 USE_FLAG='Y'인 레코드로 제어됩니다.